# 节点库开发指南

## 概述

自动精灵IDE支持从GitHub导入节点库，节点库是一组预定义的代码片段，可以在编写脚本时快速插入使用。

## 节点库格式规范

### 目录结构

节点库仓库应遵循以下目录结构：

```
node-library/
├── Information/
│   └── library.json      # 节点库信息文件
├── main/
│   ├── basic.jsonl       # 基础节点
│   ├── advanced.jsonl    # 高级节点
│   └── custom.jsonl      # 自定义节点
└── README.md
```

### 节点库信息文件 (library.json)

```json
{
  "name": "节点库名称",
  "version": "1.0.0",
  "author": "作者名",
  "description": "节点库描述",
  "repository": "https://github.com/username/node-library"
}
```

### 节点数据格式 (JSONL)

每个 `.jsonl` 文件中，每行是一个独立的JSON对象，代表一个节点：

```jsonl
{"id":"node-001","name":"点击坐标","nodeName":"click","description":"点击屏幕指定坐标","tags":["点击","基础"],"code":"zdjl.click(x, y);","author":"开发者","createdAt":"2024-01-01"}
{"id":"node-002","name":"滑动操作","nodeName":"swipe","description":"从起点滑动到终点","tags":["滑动","手势"],"code":"zdjl.swipe(x1, y1, x2, y2, duration);","author":"开发者","createdAt":"2024-01-01"}
```

## 节点字段说明

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | string | 是 | 节点唯一标识符 |
| name | string | 是 | 节点显示名称 |
| nodeName | string | 否 | 节点引用名称（用于代码提示） |
| description | string | 是 | 节点功能描述 |
| tags | string[] | 否 | 标签数组，用于分类和搜索 |
| code | string | 否 | 节点代码模板 |
| author | string | 否 | 节点作者 |
| createdAt | string | 否 | 创建时间 |

## 创建自定义节点库

### 步骤1：创建GitHub仓库

1. 在GitHub上创建一个新的公开仓库
2. 仓库命名建议：`zdjl-nodes-xxx` 或 `zdjl-node-library`

### 步骤2：创建目录结构

```bash
mkdir -p Information main
```

### 步骤3：编写节点文件

创建 `main/nodes.jsonl` 文件：

```jsonl
{"id":"toast-basic","name":"显示提示","nodeName":"toast","description":"在屏幕上显示短暂提示信息","tags":["提示","UI"],"code":"zdjl.toast(\"提示内容\");","author":"YourName","createdAt":"2024-01-01"}
{"id":"click-center","name":"点击屏幕中央","nodeName":"clickCenter","description":"点击屏幕中央位置","tags":["点击","快捷"],"code":"zdjl.click(\"50%\", \"50%\");","author":"YourName","createdAt":"2024-01-01"}
{"id":"swipe-up","name":"向上滑动","nodeName":"swipeUp","description":"从下往上滑动屏幕","tags":["滑动","手势"],"code":"zdjl.swipe(\"50%\", \"80%\", \"50%\", \"20%\", 500);","author":"YourName","createdAt":"2024-01-01"}
{"id":"wait","name":"等待时间","nodeName":"wait","description":"等待指定毫秒数","tags":["等待","时间"],"code":"await new Promise(r => setTimeout(r, 1000));","author":"YourName","createdAt":"2024-01-01"}
{"id":"find-and-click","name":"查找并点击文字","nodeName":"findAndClickText","description":"查找屏幕上的文字并点击","tags":["OCR","点击","高级"],"code":"const loc = zdjl.findLocation({type: \"text\", text: \"目标文字\"}, false);\nif (loc) {\n  zdjl.click(loc.x, loc.y);\n}","author":"YourName","createdAt":"2024-01-01"}
```

### 步骤4：创建库信息文件

创建 `Information/library.json`：

```json
{
  "name": "我的节点库",
  "version": "1.0.0",
  "author": "YourName",
  "description": "自动精灵常用节点集合",
  "repository": "https://github.com/YourName/zdjl-node-library"
}
```

### 步骤5：推送到GitHub

```bash
git add .
git commit -m "初始化节点库"
git push origin main
```

## 在IDE中导入节点库

1. 打开自动精灵IDE
2. 点击菜单 **节点库** → **导入节点库**
3. 输入GitHub仓库地址，例如：`https://github.com/YourName/zdjl-node-library`
4. 点击 **导入** 按钮

## 使用节点库

### 方法1：通过代码提示

在编辑器中输入 `node: ` 后，会自动弹出节点选择面板：

```javascript
// 输入 node: 后会显示节点列表
const result = node: 
```

### 方法2：通过节点库面板

1. 点击菜单 **节点库** → **管理节点库**
2. 查看已导入的节点库
3. 点击节点可复制代码模板

## 节点模板变量

节点代码支持以下模板变量：

| 变量 | 说明 |
|------|------|
| `${cursor}` | 光标位置 |
| `${selected}` | 选中的文本 |

示例：

```json
{"id":"click-var","name":"点击变量坐标","code":"zdjl.click(${cursor}, ${cursor});"}
```

## 最佳实践

### 1. 合理分类

使用标签对节点进行分类，便于搜索：

```json
{"tags": ["点击", "基础", "常用"]}
{"tags": ["OCR", "识别", "高级"]}
{"tags": ["网络", "请求", "API"]}
```

### 2. 详细描述

提供清晰的功能描述和使用说明：

```json
{"description": "查找屏幕上的文字并点击，支持模糊匹配和区域限制"}
```

### 3. 完整代码示例

提供可直接使用的代码模板：

```json
{"code": "const response = await zdjl.requestUrlAsync({\n  url: \"https://api.example.com\",\n  method: \"GET\"\n});\nconsole.log(response.body);"}
```

### 4. 版本管理

在 `library.json` 中维护版本号，方便用户了解更新：

```json
{
  "version": "1.1.0",
  "changelog": "新增OCR相关节点"
}
```

## 示例节点库

完整的示例节点库可以参考：

- [zdjl-official-nodes](https://github.com/zdjl/official-nodes) - 官方节点库
- [zdjl-community-nodes](https://github.com/zdjl/community-nodes) - 社区节点库

## 常见问题

### Q: 导入失败怎么办？

A: 请检查：
1. GitHub仓库是否为公开仓库
2. 目录结构是否正确（必须有 `main/` 目录）
3. JSONL文件格式是否正确（每行一个有效JSON）

### Q: 如何更新节点库？

A: 在节点库管理面板中，点击对应节点库的刷新按钮即可获取最新版本。

### Q: 可以使用私有仓库吗？

A: 目前仅支持公开的GitHub仓库。私有仓库需要额外配置访问权限。

## 贡献指南

欢迎向社区贡献您的节点：

1. Fork 官方节点库仓库
2. 添加您的节点到 `main/` 目录
3. 提交 Pull Request
4. 等待审核合并

---

如有问题，请在GitHub上提交Issue。
